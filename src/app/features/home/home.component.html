<main>
    <div class="top-bar">
        <div class="search-box">
            <span class="search-icon">üîç</span>
            <input 
                type="text" 
                [placeholder]="activeTab === 'NEEDS' ? 'Buscar vagas...' : 'Buscar prestadores (ex: Pedreiro)'" 
                [(ngModel)]="searchTerm"
                (input)="onSearch()">
            <span *ngIf="searchTerm" (click)="searchTerm=''; onSearch()" class="clear-btn">‚úï</span>
        </div>

        <div class="tabs">
            <button 
                class="tab-btn" 
                [class.active]="activeTab === 'PROVIDERS'"
                (click)="switchTab('PROVIDERS')">
                Prestadores
            </button>
            <button 
                class="tab-btn" 
                [class.active]="activeTab === 'NEEDS'"
                (click)="switchTab('NEEDS')">
                Necessidade
            </button>
        </div>

        <button *ngIf="activeTab === 'NEEDS'" class="publish-btn" (click)="goToPublish()">
            <span class="icon">üìÑ</span> Publicar Necessidade
        </button>
    </div>

    <section class="feed-container" (scroll)="onScroll($event)">
        
        @if (activeTab === 'PROVIDERS') {
            @for (provider of providers; track provider.id) {
                <div class="provider-card">
                    <div class="card-header">
                        <div class="user-info">
                            <img [src]="provider.avatarUrl" class="avatar">
                            <div class="text-info">
                                <span class="name">
                                    {{ provider.name }}
                                    <img *ngIf="provider.isVerified" src="/icons/sucess.svg" width="12">
                                </span>
                                <div class="rating">‚≠ê {{ provider.rating }}</div>
                            </div>
                        </div>
                    </div>
                    <div class="location">üìç {{ provider.location }}</div>
                    <div class="skills">
                        @for (skill of provider.skills; track $index) {
                            <span class="tag">üè∑Ô∏è {{ skill }}</span>
                        }
                    </div>
                    <div class="card-footer">
                        <button class="icon-btn">ü§ç</button>
                        <button class="icon-btn chat-btn" (click)="openChat(provider.id)">üí¨</button>
                    </div>
                </div>
            }
            @if (providers.length === 0) {
                <div class="empty-state">Nenhum prestador encontrado.</div>
            }
        }

        @if (activeTab === 'NEEDS') {
            @for (item of opportunities; track item.id) {
                <div class="opportunity-card">
                    <div class="card-header">
                        <div class="user-info">
                            <img [src]="item.contractorAvatar" class="avatar">
                            <span class="name">{{ item.contractorName }}</span>
                            <img *ngIf="item.isVerified" src="/icons/sucess.svg" class="badge" width="14">
                        </div>
                        <span class="price">{{ item.price | currency:'BRL' }}</span>
                    </div>
                    <h3 class="card-title">{{ item.title }}</h3>
                    <div class="location">üìç {{ item.location }} <span class="time">‚Ä¢ {{ item.timePosted }}</span></div>
                    <div class="description"><p>{{ item.description }}</p></div>
                    
                    <div class="card-images" *ngIf="item.images.length > 0">
                        @for (img of item.images; track $index) {
                            <img [src]="img" class="thumb">
                        }
                    </div>

                    <div class="card-footer">
                        <button class="icon-btn">ü§ç</button>
                        <button class="icon-btn chat-btn" (click)="openChat(item.id)">üí¨ Tenho Interesse</button>
                    </div>
                </div>
            }
            
            @if (isLoadingMore) {
                <div style="text-align: center; padding: 20px; color: #888;">
                    Carregando mais... ‚Üª
                </div>
            }

            @if (opportunities.length === 0) {
                <div class="empty-state">Nenhuma vaga encontrada.</div>
            }
        }

    </section>

    <app-navbar></app-navbar>
</main>